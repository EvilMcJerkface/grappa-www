<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Grappa: debugging.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grappa
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('debugging_8md.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">debugging.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="debugging_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Debugging</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;===============================================================================</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;First of all, Grappa is a very young system, so there are likely to be many bugs, and some functionality is particularly brittle at the moment. In the course of debugging our own programs, we have found ways to debug:</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;* Build with `./configure --mode=Debug` to <span class="keyword">get</span> better stack traces (note, you<span class="stringliteral">&#39;ll have to use a different CMake-generated build directory, but this prevents confusing situations where not all files were built for debug).</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">* The Google logging library we use is *really* good at getting things in order and flushing correctly. Use them and trust them. Debugging verbosity can be changed per-file with `--vmodule`. See [their documentation](http://google-glog.googlecode.com/svn/trunk/doc/glog.html).</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">* GASNet has support for suspending applications to allow you to attach to them in gdb. Calling `grappa_srun` with `--freeze-on-error` will enable this feature.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral">* **(TO BE FIXED SOON)** `system/grappa_gdb.macros`: Some useful macros for introspection into grappa data structures. Also allows you to switch to a running task and see its stack. Add the macro to your `.gdbinit` and type `help grappa` in gdb to see commands and usage.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">Performance debugging tips</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">* Grappa has a bunch of statistics that can be dumped (`Grappa::Metrics::merge_and_print()`), use these to find out basic coarse-grained information. You can also easily add your own using `GRAPPA_DEFINE_METRIC()`.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral">* Grappa also supports collecting traces of the statistics over time using VampirTrace. These can be visualized in Vampir. See the next section for how to enable tracing.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">Tracing</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral">-------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral">Grappa supports sampled tracing via VampirTrace. These traces can be visualized using the commercial tool, [Vampir](http://www.vampir.eu/). When tracing, what happens is all of the metrics specified with `GRAPPA_DEFINE_METRIC()` are sampled at a regular interval using sampling interrupts by Google&#39;</span>s `gperftools` library, and saved to a compressed trace <span class="keyword">using</span> the VampirTrace open source library. This <a class="code" href="search2_8cpp.html#ac9e7613948b8bd919d4205d430183a00">results</a> in a trace with the individual values of all of the Grappa statistics on all <a class="code" href="group___communication.html#gaff2afcac6058e98ea3c6151f2445702b">cores</a>, over the execution.</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Before configuring, ensure you have VampirTrace built somewhere. If VampirTrace is not built anywhere, there is a script to download and build it in `tools/`. Make sure to specify where to install it with the `--prefix` flag:</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;```bash</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;&gt; ./third-party/vampirtrace.rb --prefix=/sampa/share/grappa-third-party</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;```</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;To use tracing, a separate Grappa build configuration must be made <span class="keyword">using</span> either the <span class="stringliteral">&#39;--tracing&#39;</span> or <span class="stringliteral">&#39;--vampir&#39;</span> flags. If Vampir was installed in your `third-party` directory, just use <span class="stringliteral">&#39;--tracing&#39;</span>; otherwise, use <span class="stringliteral">&#39;--vampir&#39;</span> to specify the path to a separate VampirTrace install. For example:</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;```bash</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;&gt; ./configure --mode=Release --vampir=/opt/vampirtrace --third-party=/opt/grappa-third-party</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;```</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;Tracing configurations have `+Tracing` in their name. Cd into the build directory and build and <a class="code" href="group___tasking.html#ga1fa04570855ffc3d360a5264f950eb24">run</a> as usual. After <a class="code" href="_context_switch_rate__bench_8cpp.html#a36f7b6be7108281af77939ceaec42fd6">running</a> a Grappa executable, you should see trace output files show up in your build directory:</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;* `${exe}.otf`: <a class="code" href="_context_switch_rate__bench_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> file that links other trace files together</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;* `${exe}.*.events.z`: zipped trace events per process</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;For now, tracing must be explicitly enabled <span class="keywordflow">for</span> a particular region of execution, <span class="keyword">using</span> `<a class="code" href="namespace_grappa_1_1_metrics.html#a5d1f1b083a1ca74c0a276ffd26fd86cf">Metrics::start_tracing</a>()` and `<a class="code" href="namespace_grappa_1_1_metrics.html#acee0592f0f72403e5baf562e074e1f8c">Metrics::stop_tracing</a>()`. For example:</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;```cpp</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keywordtype">int</span> <a class="code" href="_context_switch_rate__bench_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="namespace_grappa.html#af7b60a124d5f39fd448e002fa2a3e11f">init</a>(&amp;argc, &amp;argv);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="group___tasking.html#ga1fa04570855ffc3d360a5264f950eb24">run</a>([]{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// setup, allocate global memory, etc</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="namespace_grappa_1_1_metrics.html#a5d1f1b083a1ca74c0a276ffd26fd86cf">Metrics::start_tracing</a>();</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// performance-critical region</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="namespace_grappa_1_1_metrics.html#acee0592f0f72403e5baf562e074e1f8c">Metrics::stop_tracing</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  });</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="namespace_grappa.html#a661c56b3ed1f67b0ae3228e67a738380">finalize</a>();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;```</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="ttc" id="_context_switch_rate__bench_8cpp_html_a36f7b6be7108281af77939ceaec42fd6"><div class="ttname"><a href="_context_switch_rate__bench_8cpp.html#a36f7b6be7108281af77939ceaec42fd6">running</a></div><div class="ttdeci">bool running</div><div class="ttdef"><b>Definition:</b> <a href="_context_switch_rate__bench_8cpp_source.html#l00067">ContextSwitchRate_bench.cpp:67</a></div></div>
<div class="ttc" id="group___communication_html_gaff2afcac6058e98ea3c6151f2445702b"><div class="ttname"><a href="group___communication.html#gaff2afcac6058e98ea3c6151f2445702b">Grappa::cores</a></div><div class="ttdeci">Core cores()</div><div class="ttdoc">How many cores are there in this job? </div><div class="ttdef"><b>Definition:</b> <a href="_communicator_8hpp_source.html#l00349">Communicator.hpp:349</a></div></div>
<div class="ttc" id="namespace_grappa_html_af7b60a124d5f39fd448e002fa2a3e11f"><div class="ttname"><a href="namespace_grappa.html#af7b60a124d5f39fd448e002fa2a3e11f">Grappa::init</a></div><div class="ttdeci">void init(int *argc_p, char **argv_p[], int64_t size)</div><div class="ttdoc">Initialize Grappa. </div><div class="ttdef"><b>Definition:</b> <a href="_grappa_8cpp_source.html#l00506">Grappa.cpp:506</a></div></div>
<div class="ttc" id="_context_switch_rate__bench_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="_context_switch_rate__bench_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="_context_switch_rate__bench_8cpp_source.html#l00070">ContextSwitchRate_bench.cpp:70</a></div></div>
<div class="ttc" id="namespace_grappa_1_1_metrics_html_a5d1f1b083a1ca74c0a276ffd26fd86cf"><div class="ttname"><a href="namespace_grappa_1_1_metrics.html#a5d1f1b083a1ca74c0a276ffd26fd86cf">Grappa::Metrics::start_tracing</a></div><div class="ttdeci">void start_tracing()</div><div class="ttdoc">Begin recording stats using VampirTrace (also enables Google gperf profiling) (also resets stats) ...</div><div class="ttdef"><b>Definition:</b> <a href="_metrics_8cpp_source.html#l00191">Metrics.cpp:191</a></div></div>
<div class="ttc" id="search2_8cpp_html_ac9e7613948b8bd919d4205d430183a00"><div class="ttname"><a href="search2_8cpp.html#ac9e7613948b8bd919d4205d430183a00">results</a></div><div class="ttdeci">GlobalAddress&lt; GlobalVector&lt; index_t &gt; &gt; results</div><div class="ttdef"><b>Definition:</b> <a href="search2_8cpp_source.html#l00004">search2.cpp:4</a></div></div>
<div class="ttc" id="namespace_grappa_1_1_metrics_html_acee0592f0f72403e5baf562e074e1f8c"><div class="ttname"><a href="namespace_grappa_1_1_metrics.html#acee0592f0f72403e5baf562e074e1f8c">Grappa::Metrics::stop_tracing</a></div><div class="ttdeci">void stop_tracing()</div><div class="ttdoc">Stop recording tracing and profiling information. </div><div class="ttdef"><b>Definition:</b> <a href="_metrics_8cpp_source.html#l00226">Metrics.cpp:226</a></div></div>
<div class="ttc" id="namespace_grappa_html_a661c56b3ed1f67b0ae3228e67a738380"><div class="ttname"><a href="namespace_grappa.html#a661c56b3ed1f67b0ae3228e67a738380">Grappa::finalize</a></div><div class="ttdeci">int finalize()</div><div class="ttdoc">Clean up Grappa. </div><div class="ttdef"><b>Definition:</b> <a href="_grappa_8cpp_source.html#l00511">Grappa.cpp:511</a></div></div>
<div class="ttc" id="group___tasking_html_ga1fa04570855ffc3d360a5264f950eb24"><div class="ttname"><a href="group___tasking.html#ga1fa04570855ffc3d360a5264f950eb24">Grappa::run</a></div><div class="ttdeci">void run(FP fp)</div><div class="ttdef"><b>Definition:</b> <a href="_tasking_8hpp_source.html#l00182">Tasking.hpp:182</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="debugging_8md.html">debugging.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
