<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Grappa: Debugging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grappa
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__sync_sampa_grappa-b_doc_debugging.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Debugging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>First of all, <a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> is a very young system, so there are likely to be many bugs, and some functionality is particularly brittle at the moment. In the course of debugging our own programs, we have found ways to debug:</p>
<ul>
<li>Build with <code>./configure --mode=Debug</code> to get better stack traces (note, you'll have to use a different CMake-generated build directory, but this prevents confusing situations where not all files were built for debug).</li>
<li>The Google logging library we use is <em>really</em> good at getting things in order and flushing correctly. Use them and trust them. Debugging verbosity can be changed per-file with <code>--vmodule</code>. See <a href="http://google-glog.googlecode.com/svn/trunk/doc/glog.html">their documentation</a>.</li>
<li>GASNet has support for suspending applications to allow you to attach to them in gdb. Calling <code>grappa_srun</code> with <code>--freeze-on-error</code> will enable this feature.</li>
<li>**(TO BE FIXED SOON)** <code>system/grappa_gdb.macros</code>: Some useful macros for introspection into grappa data structures. Also allows you to switch to a running task and see its stack. Add the macro to your <code>.gdbinit</code> and type <code>help grappa</code> in gdb to see commands and usage.</li>
</ul>
<h2>Performance debugging tips </h2>
<ul>
<li><a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> has a bunch of statistics that can be dumped (<code><a class="el" href="namespace_grappa_1_1_metrics.html#aca9bbe0e21ee6db2c50a16a71b9de903" title="Create clone of stats list, merge all stats into it, and print them. ">Grappa::Metrics::merge_and_print()</a></code>), use these to find out basic coarse-grained information. You can also easily add your own using <code><a class="el" href="group___utility.html#gaca7bf381c18a5f791155eb129c726fe7" title="Define a new Grappa Metric. ">GRAPPA_DEFINE_METRIC()</a></code>.</li>
<li><a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> also supports collecting traces of the statistics over time using VampirTrace. These can be visualized in Vampir. See the next section for how to enable tracing.</li>
</ul>
<h2>Tracing </h2>
<p><a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> supports sampled tracing via VampirTrace. These traces can be visualized using the commercial tool, <a href="http://www.vampir.eu/">Vampir</a>. When tracing, what happens is all of the metrics specified with <code><a class="el" href="group___utility.html#gaca7bf381c18a5f791155eb129c726fe7" title="Define a new Grappa Metric. ">GRAPPA_DEFINE_METRIC()</a></code> are sampled at a regular interval using sampling interrupts by Google's <code>gperftools</code> library, and saved to a compressed trace using the VampirTrace open source library. This results in a trace with the individual values of all of the <a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> statistics on all cores, over the execution.</p>
<p>Before configuring, ensure you have VampirTrace built somewhere. If VampirTrace is not built anywhere, there is a script to download and build it in <code>tools/</code>. Make sure to specify where to install it with the <code>--prefix</code> flag:</p>
<p>```bash </p>
<blockquote class="doxtable">
<p>./third-party/vampirtrace.rb &ndash;prefix=/sampa/share/grappa-third-party</p>
<p></p>
</blockquote>
<p>```</p>
<p>To use tracing, a separate <a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> build configuration must be made using either the '&ndash;tracing' or '&ndash;vampir' flags. If Vampir was installed in your <code>third-party</code> directory, just use '&ndash;tracing'; otherwise, use '&ndash;vampir' to specify the path to a separate VampirTrace install. For example:</p>
<p>```bash </p>
<blockquote class="doxtable">
<p>./configure &ndash;mode=Release &ndash;vampir=/opt/vampirtrace &ndash;third-party=/opt/grappa-third-party</p>
<p></p>
</blockquote>
<p>```</p>
<p>Tracing configurations have <code>+Tracing</code> in their name. Cd into the build directory and build and run as usual. After running a <a class="el" href="namespace_grappa.html" title="this core&#39;s base pointer ">Grappa</a> executable, you should see trace output files show up in your build directory:</p>
<ul>
<li><code>${exe}.otf</code>: main file that links other trace files together</li>
<li><code>${exe}.*.events.z</code>: zipped trace events per process</li>
</ul>
<p>For now, tracing must be explicitly enabled for a particular region of execution, using <code><a class="el" href="namespace_grappa_1_1_metrics.html#a5d1f1b083a1ca74c0a276ffd26fd86cf" title="Begin recording stats using VampirTrace (also enables Google gperf profiling) (also resets stats) ...">Metrics::start_tracing()</a></code> and <code><a class="el" href="namespace_grappa_1_1_metrics.html#acee0592f0f72403e5baf562e074e1f8c" title="Stop recording tracing and profiling information. ">Metrics::stop_tracing()</a></code>. For example:</p>
<p>```cpp int <a class="el" href="search2_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main(int argc, char* argv[])</a> { init(&amp;argc, &amp;argv); run([]{</p>
<p>// setup, allocate global memory, etc</p>
<p><a class="el" href="namespace_grappa_1_1_metrics.html#a5d1f1b083a1ca74c0a276ffd26fd86cf" title="Begin recording stats using VampirTrace (also enables Google gperf profiling) (also resets stats) ...">Metrics::start_tracing()</a>;</p>
<p>// performance-critical region</p>
<p><a class="el" href="namespace_grappa_1_1_metrics.html#acee0592f0f72403e5baf562e074e1f8c" title="Stop recording tracing and profiling information. ">Metrics::stop_tracing()</a>; }); <a class="el" href="namespace_grappa.html#a661c56b3ed1f67b0ae3228e67a738380" title="Clean up Grappa. ">finalize()</a>; } ``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
